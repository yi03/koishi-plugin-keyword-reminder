# Koishi 关键词提醒插件 (keyword-reminder)

[![npm](https://img.shields.io/npm/v/koishi-plugin-keyword-reminder?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-keyword-reminder)

## 简介

本插件允许用户在 Koishi 机器人上设置关键词提醒。当指定群聊或您与机器人所在的所有共同群聊中出现您设置的关键词时，机器人会通过**私聊**向您发送通知。

此外，插件还特别加入了**忽略用户**功能：您可以指定忽略某些用户，被忽略用户发送的消息（即使包含您设置的关键词）将**不会**触发您的提醒。这对于屏蔽机器人账号或其他不想接收其消息触发的提醒非常有用。

本插件基于 [fei-keyword-reminder](https://github.com/WhySoRed/koishi-plugin-fei-keyword-reminder) 插件开发，添加了忽略用户功能、多关键词处理、关键词高亮、全局提醒优化等多项增强。

## 命令 / 使用说明

以下是插件提供的命令列表及其用法：

*   **`提醒`**
    *   作用：显示插件的帮助信息和命令列表。
    *   示例：`提醒`

*   **`提醒.群提醒 <关键词列表> [(可选)群号]`**
    *   作用：为你设置一个或多个关键词提醒。可以设置为在特定群聊生效，或通过 `-g` 选项设置为全局生效。
    *   参数：
        *   `<关键词列表>`：必须，你想要监听的关键词，**多个关键词请用英文逗号 `,` 或中文逗号 `，` 分隔**。
            *   如果关键词本身包含逗号，请使用反斜杠 `\` 进行转义，例如 `\,` 或 `\，`。
            *   如果关键词本身包含反斜杠，请使用 `\\` 进行转义。
        *   `[(可选)群号]`：可选，目标群聊的 ID。如果省略，则默认为**当前群聊**。
    *   选项：
        *   `-g, --global`：将本次设置的关键词添加为**全局提醒**，在您和机器人所在的所有共同群聊中生效。设置全局提醒时，无需提供群号。
    *   注意：
        *   此命令不能在私聊中省略群号且不加 `-g` 选项来使用。
        *   设置全局提醒会尝试向您发送私聊确认，如果失败会在当前聊天窗口提示。
    *   示例 1：在当前群聊设置关键词 "koishi" 和 "机器人" 的提醒：`提醒.群提醒 koishi,机器人`
    *   示例 2：在群 `12345678` 设置关键词 "插件更新" 的提醒：`提醒.群提醒 插件更新 12345678`
    *   示例 3：设置全局提醒，监听 "重要通知"：`提醒.群提醒 -g 重要通知`
    *   示例 4：设置关键词 "你好\,世界" (包含逗号) 在当前群：`提醒.群提醒 你好\\,世界`
    *   示例 5：设置全局提醒，监听 "A,B" 和 "C\\D"：`提醒.群提醒 -g A\\,B,"C\\\\D"` （注意引号的使用可能取决于您的聊天环境如何处理空格和特殊字符）

*   **`提醒.删除 <要删除的关键词列表> [(可选)群号]`**
    *   作用：删除你设置的一个或多个关键词提醒。
    *   参数：
        *   `<要删除的关键词列表>`：必须，之前设置的关键词，**多个关键词用逗号 `,` 或 `，` 分隔**，转义规则同添加。
        *   `[(可选)群号]`：可选，指定要删除提醒的群聊 ID。
            *   如果**省略**群号并在**群聊中**使用，则删除当前群聊的这些关键词提醒。
            *   如果**省略**群号并在**私聊中**使用，则默认删除这些关键词的**全局提醒**。
            *   如果**提供**群号，则删除指定群聊的这些关键词提醒。
    *   选项：
        *   `-g, --global`：明确指定删除这些关键词的**全局提醒**，无论在群聊还是私聊中使用。
    *   示例 1：删除当前群聊的 "koishi" 提醒：`提醒.删除 koishi`
    *   示例 2：删除群 `12345678` 的 "插件更新" 和 "旧版本" 提醒：`提醒.删除 插件更新,旧版本 12345678`
    *   示例 3：在私聊中删除全局提醒 "重要通知"：`提醒.删除 -g 重要通知` 或 `提醒.删除 重要通知`
    *   示例 4：在群聊中明确删除全局提醒 "旧公告"：`提醒.删除 -g 旧公告`
    *   示例 5：删除关键词 "你好\,世界" 的全局提醒：`提醒.删除 -g 你好\\,世界`

*   **`提醒.列表`**
    *   作用：查看你自己设置的所有关键词提醒列表，会显示关键词及其生效范围（全局 或 特定群聊名称）。
    *   示例：`提醒.列表`

*   **`提醒.忽略 <用户>`**
    *   作用：将指定用户添加到当前机器人的提醒忽略列表。来自该用户的消息将不再触发你的任何关键词提醒。
    *   参数：
        *   `<用户>`：必须，可以是 **@提及用户** 或直接提供 **用户ID**。
    *   注意：不能忽略自己或机器人本身。
    *   示例 1：忽略 @张三：`提醒.忽略 @张三`
    *   示例 2：忽略用户 ID `987654321`：`提醒.忽略 987654321`

*   **`提醒.取消忽略 <用户>`**
    *   作用：将指定用户从当前机器人的提醒忽略列表中移除。
    *   参数：
        *   `<用户>`：必须，可以是 **@提及用户** 或直接提供 **用户ID**。
    *   示例 1：取消忽略 @张三：`提醒.取消忽略 @张三`
    *   示例 2：取消忽略用户 ID `987654321`：`提醒.取消忽略 987654321`

*   **`提醒.忽略列表`**
    *   作用：查看当前机器人实例的忽略用户列表（会尝试显示用户名和用户ID）。
    *   示例：`提醒.忽略列表`

## 提醒通知格式

当你设置的关键词被触发时，你会收到类似以下的**私聊**消息：

```
[时间戳 如: 2023/10/27 15:30:00]
来自群聊 [群聊名称] 的提醒 (关键词: "触发词1", "触发词2")
[发送者昵称] ([发送者ID]) 说：
[包含【关键词】的原始消息内容...]
```

## 注意事项

1.  **私聊权限**：提醒是通过私聊发送的。请确保机器人有权限向你发送私聊消息（例如，已添加好友，或检查平台的隐私设置）。如果机器人无法私聊你，在设置提醒时可能会在原聊天窗口收到提示，并且你将无法收到提醒通知。
2.  **忽略范围**：用户忽略列表是 **针对当前机器人实例** 生效的。如果你在多个不同的机器人上都使用了此插件，它们的忽略列表是相互独立的。
3.  **关键词匹配**：
    *   匹配方式：检查消息的文本内容是否 `包含` 你设置的关键词（区分大小写）。
    *   多关键词触发：如果一条消息包含多个你设置的关键词，这些关键词会**合并在同一条提醒**中通知你，并都会在消息内容中尝试高亮。
    *   转义：如果你的关键词包含英文逗号 `,`、中文逗号 `，` 或反斜杠 `\`，在设置或删除时需要使用 `\` 进行转义（例如 `\,`, `\，`, `\\`）。
4.  **全局提醒生效条件**：全局提醒只在你与机器人**共同所在**的群聊中生效。并且，只有当你确实是消息发出时所在群聊的成员时，才会收到该群聊触发的全局提醒。
